# WebRTC ν”„λ΅ν† μ½ μ†κ°

## 1\. WebRTCλ€

WebRTC(Web Real-Time Communication)λ” μ›Ή λΈλΌμ°μ € κ°„μ— ν”λ¬κ·ΈμΈμ λ„μ›€ μ—†μ΄ μ„λ΅ ν†µμ‹ ν•  μ μλ„λ΅ μ„¤κ³„λ APIμ΄λ‹¤. W3Cμ—μ„ μ μ‹λ μ΄μ•μ΄λ©°, μμ„± ν†µν™”, μμƒ ν†µν™”, P2P νμΌ κ³µμ  λ“±μΌλ΅ ν™μ©λ  μ μλ‹¤.

κ³µκ° μ›Ή ν‘μ¤€μΌλ΅ κµ¬ν„λλ©° λ¨λ“  μ£Όμ” λΈλΌμ°μ €μ—μ„ μΌλ° JavaScript APIλ΅ μ κ³µν•λ‹¤. (Apple, Google, Microsoft λ° Mozillaκ°€ μ§€μ›)

## 2\. WebRTCμ ν”„λ΅ν† μ½ μ†κ°

μ²μμ— peer κ°„μ μ„λ΅μ μ„μΉλ¥Ό μ•μ§€ λ»ν•κΈ° λ•λ¬Έμ— μ„λ²„λ¥Ό μ‚¬μ©ν•΄μ•Όν•κ³  κ·Έ μ„λ²„λ” peerμ μ„μΉλ¥Ό κ° peerλ“¤μ—κ² μ„μΉ μ •λ³΄λ¥Ό μ•λ ¤μ£Όλ” μ—­ν• μ„ ν•λ‹¤.

### 2-1. ICE(Interactive Connectivity Establishment)

-   ICE λ” λ‘ λ‹¨λ§μ΄ μ„λ΅ ν†µμ‹ ν•  μ μλ” μµμ μ κ²½λ΅λ¥Ό μ°Ύμ„ μ μλ„λ΅ λ„μ™€μ£Όλ” ν”„λ μ„μ›ν¬μ΄λ‹¤.
-   ICEλ” λ‘ λ‹¨λ§ κ°„μ μ μ• λ° μλ½ λ¨λΈλ΅ μƒμ„±λλ” μ‹¤μ‹κ°„ UDP λ―Έλ””μ–΄ μ¤νΈλ¦Όμ„ μ†΅μμ‹ ν•κΈ° μ„ν• NAT Traversal κΈ°μ μ΄μ§€λ§ TCPμ „μ†΅ ν”„λ΅ν† μ½μ—λ„ μ μ© κ°€λ¥ν•©λ‹λ‹¤.
-   ICEλ” STUN κ³Ό TURN ν”„λ μ„μ›ν¬λ΅ ν™•λ³΄λ ν†µμ‹  κ°€λ¥ν• μ—¬λ¬ IP μ£Όμ†μ™€ ν¬νΈ λ„λ²„λ¥Ό SDP Offerμ™€ SDP Answerλ¥Ό ν†µν•΄ μƒλ€λ°©μ—κ² μ „λ‹¬ν•λ‹¤.
-   λ‘ λ‹¨λ§μ€ ν™•λ³΄λ λ¨λ“  μ£Όμ†μ— λ€ν•΄ λ‹¨λ€λ‹¨(Peer-to-peer) μ—°κ²°μ„± ν…μ¤νΈλ¥Ό μ§„ν–‰ν•κ³  μ§„ν–‰ κ°€λ¥ν• μ£Όμ†λ΅ RTP λ―Έλ””μ–΄ μ¤νΈλ¦Όμ„ μ†΅μμ‹ ν•λ‹¤.

#### π–‹ SDP(Session Description Protocol)

-   ν•΄μƒλ„λ‚ ν•μ‹, μ½”λ±, μ•”νΈν™”λ“±μ λ©€ν‹°λ―Έλ””μ–΄ μ»¨ν…μΈ μ μ—°κ²°μ„ μ„¤λ…ν•κΈ° μ„ν• ν‘μ¤€μ΄λ‹¤.
-   λ‘ κ°μ peerκ°€ λ‹¤λ¥Έ ν•μ½μ΄ λ°μ΄ν„°κ°€ μ „μ†΅λκ³  μλ‹¤λ” κ²ƒμ„ μ•κ² ν•΄μ¤€λ‹¤.
-   κΈ°λ³Έμ μΌλ΅ λ―Έλ””μ–΄ μ»¨ν…μΈ  μμ²΄κ°€ μ•„λ‹ μ»¨ν…μΈ μ— λ€ν• λ©”νƒ€λ°μ΄ν„° μ„¤λ…μ΄λ‹¤.
-   κΈ°μ μ μΌλ΅ λ³΄μλ©΄ SDP λ” ν”„λ΅ν† μ½μ΄ μ•„λ‹λ‹¤. κ·Έλ¬λ‚ λ°μ΄ν„° ν¬λ©§μ€ λ””λ°”μ΄μ¤κ°„μ λ―Έλ””μ–΄λ¥Ό κ³µμ ν•κΈ° μ„ν• μ—°κ²°μ„ μ„¤λ…ν•κΈ° μ„ν•΄ μ‚¬μ©ν•λ‹¤.

### 2-2. STUN(Session Traversal Utilities for NAT)

-   STUNμ€ ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ ν”„λ΅ν† μ½μ΄λ‹¤.
-   STUN ν΄λΌμ΄μ–ΈνΈλ” μ‚¬μ„¤λ§μ— μ„μΉν•κ³  STUN μ„λ²„λ” μΈν„°λ„· λ§μ— μ„μΉν•λ‹¤. STUN ν΄λΌμ΄μ–ΈνΈλ” μμ‹ μ **κ³µμΈ IP μ£Όμ†**λ¥Ό μ‚¬μ „μ— ν™•μΈν•κΈ° μ„ν•΄ STUN μ„λ²„μ—κ² μ”μ²­ν•κ³ , STUN μ„λ²„λ” STUN ν΄λΌμ΄μ–ΈνΈκ°€ μ‚¬μ©ν•λ” κ³µμΈ IP μ£Όμ†λ¥Ό μ‘λ‹µν•λ‹¤.
-   STUN ν΄λΌμ΄μ–ΈνΈλ” μμ‹ μ΄ μ‚¬μ©ν•  κ³µμΈ IP μ£Όμ†λ¥Ό μ• μ μ—†μΌλ―€λ΅ STUN μ„λ²„μ—κ² μμ‹ μ κ³µμΈ IP μ£Όμ†λ¥Ό μ”μ²­ν•λ‹¤.
    -   STUN μ΄ ν•­μƒ ν¨κ³Όμ μ΄μ§€λ” μ•λ‹¤. λ‘ λ‹¨λ§μ΄ κ°™μ€ NAT ν™κ²½μ— μμ„ κ²½μ° STUN μ€ λ™μ‘ν•μ§€ μ•λ”λ‹¤.
    -   λν• Symmetric NAT λ΅ λ™μ‘ν•λ” μ‚¬μ„¤λ§ ν™κ²½μ—μ„λ” μ–΄ν”λ¦¬μΌ€μ΄μ…μ΄ λ‹¤λ¥΄λ©΄ NAT λ§¤ν•‘ ν…μ΄λΈ”μ΄ λ°”λ€κΈ° λ•λ¬Έμ— μ‚¬μ©ν•  μ μ—†λ‹¤.

![](https://mdn.mozillademos.org/files/6115/webrtc-stun.png)

### 2-3 NAT (Network Address Translation)

-   NAT (Network Address Translation)λ‹¨λ§μ— κ³µκ° IPμ£Όμ†λ¥Ό ν• λ‹Ήν•κΈ° μ„ν•΄ μ‚¬μ©λ©λ‹λ‹¤.
-   λΌμ°ν„°λ” κ³µμΈ IP μ£Όμ†λ¥Ό κ°–κ³  μκ³  λ¨λ“  λ‹¨λ§λ“¤μ€ λΌμ°ν„°μ— μ—°κ²°λμ–΄ μμΌλ©° λΉ„κ³µκ° IPμ£Όμ†(private IP Address)λ¥Ό κ°–κ³  μμµλ‹λ‹¤.
-   μ”μ²­μ€ λ‹¨λ§μ λΉ„κ³µκ° μ£Όμ†λ΅λ¶€ν„° λΌμ°ν„°μ κ³µκ° μ£Όμ†μ™€ μ μΌν• ν¬νΈλ¥Ό κΈ°λ°μΌλ΅ λ²μ—­ν•λ‹¤. μ΄ λ•λ¶„μ—, κ°κ°μ λ‹¨λ§μ΄ μ μΌν• κ³µμΈ IP μ—†μ΄ μΈν„°λ„· μƒμ—μ„ κ²€μƒ‰ κ°€λ¥ν•λ‹¤.
-   μ–΄λ– ν• λΌμ°ν„°λ“¤μ€ λ„¤νΈμ›ν¬μ— μ—°κ²°ν• μ μλ” μ ν•μ„ κ°–κ³  μμµλ‹λ‹¤. λ”°λΌμ„ **STUNμ„λ²„μ— μν•΄ κ³µμΈ IPμ£Όμ†λ¥Ό λ°κ²¬ν•λ‹¤κ³  ν•΄λ„ λ¨λ‘κ°€ μ—°κ²°μ„ ν• μ μλ‹¤λ” κ²ƒμ€ μ•„λ‹™λ‹λ‹¤.** μ΄λ¥Ό μ„ν•΄ TURNμ΄ ν•„μ”ν•©λ‹λ‹¤.

### 2-4. TURN(Traversal Using Relays around NAT)

-   λ‡λ‡μ λΌμ°ν„°λ“¤μ€ Symmetric NATμ΄λΌκ³  λ¶λ¦¬μ°λ” μ ν•μ„ μ„ν• NATμ„ μ±„μ©ν•κ³  μμµλ‹λ‹¤. μ΄ λ§μ€ peerλ“¤μ΄ μ¤μ§ μ΄μ „μ— μ—°κ²°ν• μ  μλ” μ—°κ²°λ“¤λ§ ν—μ©ν•λ‹¤λ” κ²ƒμ…λ‹λ‹¤. μ΄ λ•λ¬Έμ— TURN μ„λ²„λ¥Ό μ΄μ©ν•λ‹¤.
-   TURN μ„λ²„μ™€ μ—°κ²°ν•κ³  λ¨λ“  μ •λ³΄λ¥Ό κ·Έ μ„λ²„μ— μ „λ‹¬ν•λ” κ²ƒμΌλ΅ Symmetric NAT μ ν•μ„ μ°νν•λ” κ²ƒμ„ μλ―Έν•λ‹¤.
-   TURN ν΄λΌμ΄μ–ΈνΈλ” μ‚¬μ„¤λ§μ— μ„μΉν•κ³  TURN μ„λ²„λ” μΈν„°λ„·λ§μ— μ„μΉν•λ‹¤.
-   TURN μ€ Peer λ“¤κ°„μ λ―Έλ””μ–΄ μ¤νΈλ¦¬λ°μ„ λ¦΄λ μ΄ν•κΈ° μ„ν•΄ μ‚¬μ©λλ‹¤.
-   **TURN ν΄λΌμ΄μ–ΈνΈλ” ν†µν™”λ¥Ό ν•  ν”Όμ–΄λ“¤κ³Ό μ§μ ‘ ν†µμ‹ ν•λ” κ²ƒμ΄ μ•„λ‹λΌ λ¦΄λ μ΄ μ„λ²„ μ—­ν• μ„ ν•λ” TURN μ„λ²„λ¥Ό κ²½μ ν•λ‹¤.**
-   **TURN μ„λ²„λ” μΈν„°λ„·λ§μ— μ„μΉν•κ³  κ° Peer(λ‹¨λ§)λ“¤μ΄ μ‚¬μ„¤λ§(Private IP) μ•μ—μ„ ν†µμ‹ ν•λ‹¤. κ° Peerλ“¤μ΄ μ§μ ‘ ν†µμ‹ ν•λ” κ²ƒμ΄ μ•„λ‹λΌ λ¦΄λ μ΄ μ—­ν• μ„ ν•λ” TURN μ„λ²„λ¥Ό μ‚¬μ©ν•μ—¬ κ²½μ ν•λ‹¤.**
-   TURN ν”„λ΅ν† μ½μ€ NAT ν™κ²½μ— λ‹¨λ§μ΄ λ¦΄λ μ΄ μ„λ²„λ¥Ό μ΄μ©ν•μ—¬ ν†µμ‹ ν•κ² ν•λ‹¤.
-   μ΄κ²ƒμ€ λ…λ°±ν μ¤λ²„ν—¤λ“κ°€ λ°μƒν•λ―€λ΅ μ΄ λ°©λ²•μ€ λ‹¤λ¥Έ λ€μ•μ΄ μ—†μ„ κ²½μ°λ§ μ‚¬μ©ν•κ² λ©λ‹λ‹¤.
- TURNμ μμ„Έν• λ‚΄μ©μ€ [μ—¬κΈ°](https://brunch.co.kr/@linecard/156)λ¥Ό μ°Έκ³ ν•΄μ£Όμ„Έμ”.

![](https://mdn.mozillademos.org/files/6117/webrtc-turn.png)


### 2-5 STUNκ³Ό TURN μ΄κ°„λ‹¨ μ •λ¦¬

STUNμ€ λ‹¨λ§μ΄ μμ‹ μ κ³µμΈ IP μ£Όμ†μ™€ ν¬νΈλ¥Ό ν™•μΈν•λ” κ³Όμ •μ— λ€ν• ν”„λ΅ν† μ½μ΄κ³ , TURNμ€ λ‹¨λ§μ΄ ν¨ν‚·μ„ λ¦΄λ μ΄ μ‹μΌ μ¤„ μ„λ²„λ¥Ό ν™•μΈν•λ” κ³Όμ •μ— λ€ν• ν”„λ΅ν† μ½μ…λ‹λ‹¤. STUN μ„λ²„λ” μ‚¬μ„¤ μ£Όμ†μ™€ κ³µμΈ μ£Όμ†λ¥Ό λ°”μΈλ”©ν•κ³ , TURN μ„λ²„λ” λ¦΄λ μ΄ μ£Όμ†λ¥Ό ν• λ‹Ήν•©λ‹λ‹¤. νΉν TURNμ€ ICEμ—μ„ μ§μ ‘ μ‚¬μ©ν•©λ‹λ‹¤.

### 2-6 ICE Candidate Gathering

ICEλ¥Ό μ‹¤ν–‰ν•λ” λ‹¨λ§λ“¤μ€ ν†µμ‹ μ΄ κ°€λ¥ν• λ¨λ“  μ£Όμ†λ¥Ό μ‹λ³„ν•©λ‹λ‹¤. μ²μμ— ν΄λΌμ΄μ–ΈνΈλ” STUN λ©”μ„Έμ§€λ¥Ό TURN μ„λ²„λ΅ μ „μ†΅ν•κ³  μμ‹ ν•λ” κ³Όμ •μ—μ„ λ¦΄λ μ΄ μ£Όμ†λ¥Ό ν™•μΈν•©λ‹λ‹¤.

-   λ¦΄λ μ΄ μ£Όμ†λ” TURNμ„λ²„κ°€ ν¨ν‚· λ¦΄λ μ΄λ¥Ό μ„ν•΄ ν• λ‹Ήν•λ” μ£Όμ†μ…λ‹λ‹¤.

### 2-7 ICE μ—°κ²°μ„± μ²΄ν¬

λ‘ λ‹¨λ§μ€ TURN μ„λ²„μ™€ λ©”μ‹μ§€ κµν™μ„ ν†µν•΄ μμ‹ μ 3κ° Candidate μ£Όμ†λ¥Ό ν™•μΈν•κ³  SDP Offerμ™€ SDP Answerλ¥Ό ν†µν•΄ μƒλ€λ°©μ 3κ° Candidate μ£Όμ†λ¥Ό ν™•μΈν•©λ‹λ‹¤.

-   Candidateλ” IP μ£Όμ†μ™€ ν¬νΈ λ„λ²„μ μ΅°ν•©μΌλ΅ ν‘μ‹λ μ£Όμ†λ¥Ό μλ―Έν•©λ‹λ‹¤.

## μ°Έκ³ 

-   [https://developer.mozilla.org/ko/docs/Web/API/WebRTC\_API](https://developer.mozilla.org/ko/docs/Web/API/WebRTC_API)
-   [http://wiki.pchero21.com/wiki/ICE(Interactive\_Connectivity\_Establishment)](http://wiki.pchero21.com/wiki/ICE(Interactive_Connectivity_Establishment))