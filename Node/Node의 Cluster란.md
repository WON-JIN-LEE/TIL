# Node의 Cluster란

Node.js는 싱글스레드이지만, cluster 모듈을 사용하면 작업을 병렬적으로 처리하도록 하여 손쉽게 멀티 스레드로 구현이 가능합니다. 

이를 이용하여 요청을 분산시켜서 서버가 오버로드 되지 않도록 하는 것입니다. 이는 성능 개선에도 큰 효과를 줍니다.

Node.js는 기본적으로 v8엔진의 제한을 그대로 반영하기 때문에 하나의 프로세스가 사용할 수 있는 메모리의 양이 제한되어 있습니다.

## 클러스터는 어떻게 동작하나?
클러스터에는 마스터 프로세스와 워커 프로세스가 있습니다.

마스터 프로세스는 CPU 코어 수 만큼 워커 프로세스를 만들고 8080 포트에서 대기합니다. 8080 포트로 요청이 들어오면, 마스터 프로세스는 워커 프로세스에게 요청을 분배합니다. 워커 프로세스는 실질적으로 일을 하는 프로세스를 말합니다.

### CPU 코어를 모두 사용한다는 것의 의미?

코어가 8개인 서버가 있을 경우 노드는 기본적으로 하나의 코어만 활용합니다. 그러나 cluster 모듈을 사용하면 코어 하나 당 노드 프로세스 하나가 돌아가게 할 수 있습니다. 성능이 8배가 되는 것은 아니지만 코어 하나만 사용할 때보다 훨씬 개선되는 것은 사실입니다.

그러나 코어 하나 당 프로세스가 돌아가기 때문에 메모리 세션을 공유하지 못하는데, 이는 Redis 서버를 도입하여 해결할 수 있습니다.